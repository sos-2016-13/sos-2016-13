<html>
<head>

<script src="https://code.jquery.com/jquery-1.12.3.min.js"></script>
<script src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css">

</head>
<body style="background-color: #448E83">
<h1>Eugenio Jesus Rodriguez Molina (Population and electricity access)</h1>

<button style="border: #000 2px solid; background-color: #99CCFF"  id ="loadInitialData" >loadInitialData</button>
<button style="border: #000 2px solid; background-color: #99CCFF" id ="Add"> Add</button>   
<button style="border: #000 2px solid; background-color: #99CCFF" id ="Edit">Edit</button>
<button style="border: #000 2px solid; background-color: #99CCFF" id ="Delete">Delete</button>
<button style="border: #000 2px solid; background-color: #99CCFF"  id ="DeleteAll"> DeleteAll</button>
<button style="border: #000 2px solid; background-color: #99CCFF" id ="SeeAll"> SeeAll</button>
<button style="border: #000 2px solid; background-color: #99CCFF" id ="buscar"> Buscar</button>
<center>Apikey:<input  id="apikey"></input>
Country:<input id="country"> </input>
Year:<input id="year"> </input>
Population:<input id="population"> </input>
Access_to_Electricity<input id="access_to_electricity"> </input></center>
<center>Desde<input id="desde"></input>
Hasta<input id="hasta"></input></center>
Paginación: </br></br> <select id= "pag" name="pag" >
   <center><option value="0">0  Elementos</option> 
   <option value="1">1</option> 
   <option value="2">2</option> 
   <option value="3">3</option>

</select></br> <input id="pag2" ></input>
</center>
<script >
$(document).ready(function() {
    $('#location').DataTable();

} );

</script>







<table  style="background-color:#5E6A6A"id="location" class="display" cellspacing="0" width="100%"  >
    <tr style="background-color:#F4390B">
        <th>Countries</th>
         <th>Year</th>
		 <th>Population</th>
		 <th>Access to Electricity</th>
    </tr>
</table>



<script>



    function refrescar(apikey){
        $.ajax(
            {
                type: "GET",
                url:"https://sos-2016-13.herokuapp.com/api/v1/population?apikey="+apikey,
                data: "{}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                cache: false,
                success: function (data) {
                    var trHTML = '';

                $.each(data, function (i, item) {
                    trHTML += '<thead><tr><td>' + item.country + '</td><td>' + item.year + '</td><td>' + item.population + '</td><td>' + item.access_to_electricity + '</td></tr></thead>';
                });

                $('#location').append(trHTML);
                },
                error: function (msg) {
                    alert(msg.responseText);
                }
             });
    }

        $("#loadInitialData").click(function(){

            $("#location td").remove(); 

        var apikey = $("#apikey").val();

        var request = $.ajax({
            url:"https://sos-2016-13.herokuapp.com/api/v1/population/loadInitialData?apikey="+apikey,
            type:"GET",
            contentType : "application/json"

             });

                request.always(function(jqXHR,status){
                errores(jqXHR,status);
                });

        refrescar(apikey);

        });


        $("#buscar").click(function(){

         $("#location td").remove(); 

        var apikey = $("#apikey").val();
        var year = $("#year").val();
        var country = $("#country").val();
        var desde = $("#desde").val();
        var hasta = $("#hasta").val();
        var pag = $("#pag").val();
        var pag2 = $("#pag2").val();

            if(year != ""){
                year = "/"+year;
            }
            if(country != ""){
                country = "/" + country;
            }
            if(desde != ""){
                desde = "&from=" + desde;
            }
            if(hasta != ""){
                hasta = "&to=" + hasta;
            }
            if(pag != ""){
                pag = "&limit=" + pag;
            }
            if(pag2 != ""){
                pag2 = "&offset=" + pag2;
            }


          var request = $.ajax(
            {
                type: "GET",
                url:"https://sos-2016-13.herokuapp.com/api/v1/population" + country + year + "?apikey="+apikey + desde + hasta + pag2 + pag,
                data: "{}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                cache: false,
                success: function (data) {
                    var trHTML = '';

                $.each(data, function (i, item) {
                    trHTML += '<thead><tr><td>' + item.country + '</td><td>' + item.year + '</td><td>' + item.population + '</td><td>' + item.access_to_electricity + '</td></tr></thead>';
                });

                $('#location').append(trHTML);
                },
                error: function (msg) {
                    alert(msg.responseText);
                }
             });

            request.always(function(jqXHR,status){
                errores(jqXHR,status);
                });
    });

      

        $("#Add").click(function(){

        $("#location td").remove(); 

        var apikey = $("#apikey").val();
        var country = $("#country").val();
        var year = $("#year").val();
        var population = $("#population").val();
        var access_to_electricity = $("#access_to_electricity").val();

                var request = $.ajax({
                    type:"POST",
                    url:"https://sos-2016-13.herokuapp.com/api/v1/population?apikey="+apikey,
                    data: '{"country":"'+country+'","year":'+year+',"population":'+population+',"access_to_electricity":'+access_to_electricity+'}',
                    contentType : "application/json"

                     });

                request.always(function(jqXHR,status){
                errores(jqXHR,status);
                });
                refrescar(apikey);
        });

        $("#Edit").click(function(){

        $("#location td").remove(); 

        var apikey = $("#apikey").val();
        var country = $("#country").val();
        var year = $("#year").val();
        var population = $("#population").val();
        var access_to_electricity = $("#access_to_electricity").val();

        var request = $.ajax({
            url:"https://sos-2016-13.herokuapp.com/api/v1/population/" + country + "/" + year + "?apikey="+apikey,
            type:"PUT",
            data: '{"country":"'+country+'","year":'+year+',"population":'+population+',"access_to_electricity":'+access_to_electricity+'}',
            contentType : "application/json"

             });

                request.always(function(jqXHR,status){
                errores(jqXHR,status);
                });

                refrescar(apikey);
        });



        $("#Delete").click(function(){

        $("#location td").remove(); 

        var apikey = $("#apikey").val();
        var country = $("#country").val();
        var year = $("#year").val();

        var request = $.ajax({
            url:"https://sos-2016-13.herokuapp.com/api/v1/population/" + country + "/" + year + "?apikey="+apikey,
            type:"DELETE",
            contentType : "application/json"

             });

                request.always(function(jqXHR,status){
                errores(jqXHR,status);
                });
                refrescar(apikey);
        });


        $("#DeleteAll").click(function(){

            $("#location td").remove(); 

        var apikey = $("#apikey").val();

            var request = $.ajax({
            url:"https://sos-2016-13.herokuapp.com/api/v1/population?apikey="+apikey,
            type:"DELETE",
            contentType : "application/json"

             });

             request.always(function(jqXHR,status){
                errores(jqXHR,status);
                });
             refrescar(apikey);
        });

        $("#SeeAll").click(function(){

            $("#location td").remove(); 

        var apikey = $("#apikey").val();

        var request = $.ajax(
        {
            type: "GET",
            url: 'https://sos-2016-13.herokuapp.com/api/v1/population?apikey='+apikey,
            data: "{}",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            cache: false,
            success: function (data) {
                var trHTML = '';

            $.each(data, function (i, item) {
                trHTML += '<thead><tr><td>' + item.country + '</td><td>' + item.year + '</td><td>' + item.population + '</td><td>' + item.access_to_electricity + '</td></tr></thead>';
            });

            $('#location').append(trHTML);
            },
            error: function (msg) {
                alert(msg.responseText);
            }



         });
                request.always(function(jqXHR,status){
                errores(jqXHR,status);
                });
    });

function errores(jqXHR,status){
    if(status=="error"){
                    if(jqXHR.status == "401"){
                        $("#status").text("Apikey incorrecta, por favor inserte una apikey correcta");
                    }else if (jqXHR.status == "409"){
                        $("#status").text("No se puede añadir ese registro, ese dato ya existe.");
                    }
                    
                }else{
                    $("#status").text("")
                }
            };
    </script>

        

        
                
                

</body>
</html>